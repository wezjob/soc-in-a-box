{
  "rules": [
    {
      "name": "MITRE T1071.001 - CobaltStrike Beacon Activity",
      "description": "Detects potential CobaltStrike Beacon C2 communication patterns",
      "risk_score": 90,
      "severity": "critical",
      "type": "query",
      "query": "alert.signature:*CobaltStrike* OR (event_type:alert AND dest_port:4444)",
      "index": ["suricata-*", "labsoc-alerts*"],
      "language": "kuery",
      "enabled": true,
      "tags": ["MITRE ATT&CK", "T1071.001", "Command and Control", "CobaltStrike"],
      "threat": [
        {
          "framework": "MITRE ATT&CK",
          "tactic": {
            "id": "TA0011",
            "name": "Command and Control",
            "reference": "https://attack.mitre.org/tactics/TA0011/"
          },
          "technique": [
            {
              "id": "T1071",
              "name": "Application Layer Protocol",
              "reference": "https://attack.mitre.org/techniques/T1071/",
              "subtechnique": [
                {
                  "id": "T1071.001",
                  "name": "Web Protocols",
                  "reference": "https://attack.mitre.org/techniques/T1071/001/"
                }
              ]
            }
          ]
        }
      ],
      "actions": [
        {
          "action": "notify",
          "channel": "high-priority",
          "message": "Critical: CobaltStrike Beacon activity detected from {{source.ip}} to {{destination.ip}}"
        }
      ]
    },
    {
      "name": "MITRE T1110.001 - SSH Brute Force Attack",
      "description": "Detects multiple failed SSH authentication attempts indicating brute force attack",
      "risk_score": 70,
      "severity": "high",
      "type": "threshold",
      "query": "destination.port:22 AND event.action:connection_attempt",
      "threshold": {
        "field": "source.ip",
        "value": 10,
        "cardinality": []
      },
      "index": ["suricata-*", "zeek-*", "auditbeat-*"],
      "language": "kuery",
      "enabled": true,
      "tags": ["MITRE ATT&CK", "T1110.001", "Credential Access", "Brute Force"],
      "threat": [
        {
          "framework": "MITRE ATT&CK",
          "tactic": {
            "id": "TA0006",
            "name": "Credential Access",
            "reference": "https://attack.mitre.org/tactics/TA0006/"
          },
          "technique": [
            {
              "id": "T1110",
              "name": "Brute Force",
              "reference": "https://attack.mitre.org/techniques/T1110/",
              "subtechnique": [
                {
                  "id": "T1110.001",
                  "name": "Password Guessing",
                  "reference": "https://attack.mitre.org/techniques/T1110/001/"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "MITRE T1071.004 - DNS Tunneling Detection",
      "description": "Detects potential DNS tunneling via unusually long DNS queries or suspicious TLDs",
      "risk_score": 75,
      "severity": "high",
      "type": "query",
      "query": "(dns.query:*.tk OR dns.query:*.ml OR dns.query:*.darknet.* OR dns.query:*.onion) OR dns.query.length > 50",
      "index": ["suricata-*", "zeek-*"],
      "language": "kuery",
      "enabled": true,
      "tags": ["MITRE ATT&CK", "T1071.004", "Command and Control", "DNS Tunneling"],
      "threat": [
        {
          "framework": "MITRE ATT&CK",
          "tactic": {
            "id": "TA0011",
            "name": "Command and Control",
            "reference": "https://attack.mitre.org/tactics/TA0011/"
          },
          "technique": [
            {
              "id": "T1071",
              "name": "Application Layer Protocol",
              "reference": "https://attack.mitre.org/techniques/T1071/",
              "subtechnique": [
                {
                  "id": "T1071.004",
                  "name": "DNS",
                  "reference": "https://attack.mitre.org/techniques/T1071/004/"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "MITRE T1046 - Network Port Scan Detection",
      "description": "Detects rapid connection attempts to multiple ports indicating port scanning",
      "risk_score": 50,
      "severity": "medium",
      "type": "threshold",
      "query": "event.action:connection_attempt",
      "threshold": {
        "field": "source.ip",
        "value": 50,
        "cardinality": [
          {
            "field": "destination.port",
            "value": 20
          }
        ]
      },
      "index": ["suricata-*", "zeek-*"],
      "language": "kuery",
      "enabled": true,
      "tags": ["MITRE ATT&CK", "T1046", "Discovery", "Port Scanning"],
      "threat": [
        {
          "framework": "MITRE ATT&CK",
          "tactic": {
            "id": "TA0007",
            "name": "Discovery",
            "reference": "https://attack.mitre.org/tactics/TA0007/"
          },
          "technique": [
            {
              "id": "T1046",
              "name": "Network Service Discovery",
              "reference": "https://attack.mitre.org/techniques/T1046/"
            }
          ]
        }
      ]
    },
    {
      "name": "MITRE T1190 - Log4Shell Exploitation Attempt",
      "description": "Detects Log4Shell (CVE-2021-44228) exploitation attempts in HTTP traffic",
      "risk_score": 95,
      "severity": "critical",
      "type": "query",
      "query": "http.request.body:*jndi* OR http.user_agent:*jndi* OR url.full:*jndi*",
      "index": ["suricata-*", "zeek-*", "logstash-*"],
      "language": "kuery",
      "enabled": true,
      "tags": ["MITRE ATT&CK", "T1190", "Initial Access", "Log4Shell", "CVE-2021-44228"],
      "threat": [
        {
          "framework": "MITRE ATT&CK",
          "tactic": {
            "id": "TA0001",
            "name": "Initial Access",
            "reference": "https://attack.mitre.org/tactics/TA0001/"
          },
          "technique": [
            {
              "id": "T1190",
              "name": "Exploit Public-Facing Application",
              "reference": "https://attack.mitre.org/techniques/T1190/"
            }
          ]
        }
      ]
    },
    {
      "name": "MITRE T1505.003 - Web Shell Activity",
      "description": "Detects potential web shell activity via suspicious HTTP parameters",
      "risk_score": 85,
      "severity": "high",
      "type": "query",
      "query": "(url.query:*cmd=* OR url.query:*exec=* OR url.query:*shell=*) OR (http.request.body:*eval* AND http.request.body:*base64*)",
      "index": ["suricata-*", "zeek-*"],
      "language": "kuery",
      "enabled": true,
      "tags": ["MITRE ATT&CK", "T1505.003", "Persistence", "Web Shell"],
      "threat": [
        {
          "framework": "MITRE ATT&CK",
          "tactic": {
            "id": "TA0003",
            "name": "Persistence",
            "reference": "https://attack.mitre.org/tactics/TA0003/"
          },
          "technique": [
            {
              "id": "T1505",
              "name": "Server Software Component",
              "reference": "https://attack.mitre.org/techniques/T1505/",
              "subtechnique": [
                {
                  "id": "T1505.003",
                  "name": "Web Shell",
                  "reference": "https://attack.mitre.org/techniques/T1505/003/"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "MITRE T1567.002 - Data Exfiltration to Cloud Storage",
      "description": "Detects large file uploads to cloud storage services",
      "risk_score": 65,
      "severity": "medium",
      "type": "query",
      "query": "(destination.domain:*dropbox.com OR destination.domain:*drive.google.com OR destination.domain:*onedrive.live.com) AND http.request.method:POST",
      "index": ["suricata-*", "zeek-*"],
      "language": "kuery",
      "enabled": true,
      "tags": ["MITRE ATT&CK", "T1567.002", "Exfiltration", "Cloud Storage"],
      "threat": [
        {
          "framework": "MITRE ATT&CK",
          "tactic": {
            "id": "TA0010",
            "name": "Exfiltration",
            "reference": "https://attack.mitre.org/tactics/TA0010/"
          },
          "technique": [
            {
              "id": "T1567",
              "name": "Exfiltration Over Web Service",
              "reference": "https://attack.mitre.org/techniques/T1567/",
              "subtechnique": [
                {
                  "id": "T1567.002",
                  "name": "Exfiltration to Cloud Storage",
                  "reference": "https://attack.mitre.org/techniques/T1567/002/"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "MITRE T1486 - Ransomware File Extension Detection",
      "description": "Detects known ransomware file extensions in network traffic",
      "risk_score": 95,
      "severity": "critical",
      "type": "query",
      "query": "file.name:(*.encrypted OR *.locky OR *.wannacry OR *.cryptolocker OR *.cerber OR *.crypt)",
      "index": ["suricata-*", "zeek-*", "auditbeat-*"],
      "language": "kuery",
      "enabled": true,
      "tags": ["MITRE ATT&CK", "T1486", "Impact", "Ransomware"],
      "threat": [
        {
          "framework": "MITRE ATT&CK",
          "tactic": {
            "id": "TA0040",
            "name": "Impact",
            "reference": "https://attack.mitre.org/tactics/TA0040/"
          },
          "technique": [
            {
              "id": "T1486",
              "name": "Data Encrypted for Impact",
              "reference": "https://attack.mitre.org/techniques/T1486/"
            }
          ]
        }
      ]
    },
    {
      "name": "MITRE T1021.002 - SMB Lateral Movement",
      "description": "Detects SMB admin share access indicating lateral movement",
      "risk_score": 70,
      "severity": "high",
      "type": "query",
      "query": "destination.port:445 AND (smb.share:ADMIN$ OR smb.share:C$ OR smb.share:IPC$)",
      "index": ["suricata-*", "zeek-*"],
      "language": "kuery",
      "enabled": true,
      "tags": ["MITRE ATT&CK", "T1021.002", "Lateral Movement", "SMB"],
      "threat": [
        {
          "framework": "MITRE ATT&CK",
          "tactic": {
            "id": "TA0008",
            "name": "Lateral Movement",
            "reference": "https://attack.mitre.org/tactics/TA0008/"
          },
          "technique": [
            {
              "id": "T1021",
              "name": "Remote Services",
              "reference": "https://attack.mitre.org/techniques/T1021/",
              "subtechnique": [
                {
                  "id": "T1021.002",
                  "name": "SMB/Windows Admin Shares",
                  "reference": "https://attack.mitre.org/techniques/T1021/002/"
                }
              ]
            }
          ]
        }
      ]
    },
    {
      "name": "MITRE T1059.001 - PowerShell Download Cradle",
      "description": "Detects PowerShell download cradle patterns in network traffic",
      "risk_score": 80,
      "severity": "high",
      "type": "query",
      "query": "(http.user_agent:*PowerShell* OR url.full:*IEX* OR url.full:*Invoke-Expression*) AND http.request.method:GET",
      "index": ["suricata-*", "zeek-*"],
      "language": "kuery",
      "enabled": true,
      "tags": ["MITRE ATT&CK", "T1059.001", "Execution", "PowerShell"],
      "threat": [
        {
          "framework": "MITRE ATT&CK",
          "tactic": {
            "id": "TA0002",
            "name": "Execution",
            "reference": "https://attack.mitre.org/tactics/TA0002/"
          },
          "technique": [
            {
              "id": "T1059",
              "name": "Command and Scripting Interpreter",
              "reference": "https://attack.mitre.org/techniques/T1059/",
              "subtechnique": [
                {
                  "id": "T1059.001",
                  "name": "PowerShell",
                  "reference": "https://attack.mitre.org/techniques/T1059/001/"
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}
